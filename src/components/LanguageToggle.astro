---
// Language toggle component - Simple localStorage-based toggle
---

<div class="language-toggle">
  <button
    id="lang-toggle"
    class="flex items-center gap-2 px-4 py-2.5 text-sm font-bold text-white bg-blue-dark-600/50 hover:bg-blue-dark-600 border-2 border-orange-500/30 hover:border-orange-500/50 rounded-lg transition-all backdrop-blur-sm"
    aria-label="Toggle language"
  >
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
    </svg>
    <span id="current-lang" class="min-w-[2rem] text-center">EN</span>
  </button>
</div>

<script is:inline>
  (function() {
    function getCurrentLanguage() {
      if (typeof window === 'undefined' || !window.localStorage) return 'en';
      return localStorage.getItem('language') || 'en';
    }

    function setLanguage(lang) {
      if (typeof window === 'undefined' || !window.localStorage) return;
      localStorage.setItem('language', lang);
      updateLanguageDisplay();
      applyTranslations(lang);
    }

    function updateLanguageDisplay() {
      const langSpan = document.getElementById('current-lang');
      const currentLang = getCurrentLanguage();
      if (langSpan) {
        langSpan.textContent = currentLang.toUpperCase();
      }
      if (document.documentElement) {
        document.documentElement.lang = currentLang;
      }
    }

    function applyTranslations(lang) {
      if (typeof document === 'undefined') return;
      
      // Update HTML lang attribute
      if (document.documentElement) {
        document.documentElement.lang = lang;
      }
      
      // Translate all elements with data-en and data-es attributes
      document.querySelectorAll('[data-en][data-es]').forEach((el) => {
        if (el instanceof HTMLElement) {
          if (lang === 'es' && el.dataset.es) {
            el.textContent = el.dataset.es;
          } else if (el.dataset.en) {
            el.textContent = el.dataset.en;
          }
        }
      });
      
      // Dispatch event for other components
      if (typeof window !== 'undefined') {
        window.dispatchEvent(new CustomEvent('languageChanged', { 
          detail: { language: lang } 
        }));
      }
    }

    function toggleLanguage(e) {
      e.preventDefault();
      e.stopPropagation();
      const currentLang = getCurrentLanguage();
      const newLang = currentLang === 'en' ? 'es' : 'en';
      setLanguage(newLang);
      return false;
    }

    // Initialize when DOM is ready
    function init() {
      const toggleButton = document.getElementById('lang-toggle');
      if (toggleButton) {
        toggleButton.addEventListener('click', toggleLanguage);
        toggleButton.addEventListener('touchstart', toggleLanguage);
      }
      
      // Apply saved language
      const savedLang = getCurrentLanguage();
      updateLanguageDisplay();
      applyTranslations(savedLang);
    }

    // Run immediately if DOM is ready, otherwise wait
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  })();
</script>

