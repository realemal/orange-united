---
// Language toggle component - Simple localStorage-based toggle
---

<div class="language-toggle">
  <button
    id="lang-toggle"
    type="button"
    class="flex items-center gap-2 px-4 py-2 text-sm font-bold text-gray-700 hover:text-orange-500 transition-colors rounded-lg hover:bg-orange-50 border border-gray-200"
    aria-label="Toggle language"
  >
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
    </svg>
    <span id="current-lang" class="min-w-[2rem] text-center">EN</span>
  </button>
</div>

<script define:vars={{}}>
  // Language toggle functionality
  (function() {
    'use strict';
    
    const STORAGE_KEY = 'orange-united-language';
    
    function getCurrentLanguage() {
      try {
        return localStorage.getItem(STORAGE_KEY) || 'en';
      } catch (e) {
        return 'en';
      }
    }

    function setLanguage(lang) {
      try {
        localStorage.setItem(STORAGE_KEY, lang);
      } catch (e) {
        console.warn('Could not save language preference');
      }
      updateLanguageDisplay();
      applyTranslations(lang);
    }

    function updateLanguageDisplay() {
      const langSpan = document.getElementById('current-lang');
      const currentLang = getCurrentLanguage();
      if (langSpan) {
        langSpan.textContent = currentLang.toUpperCase();
      }
      if (document.documentElement) {
        document.documentElement.setAttribute('lang', currentLang);
      }
    }

    function applyTranslations(lang) {
      if (!document) return;
      
      // Update HTML lang attribute
      if (document.documentElement) {
        document.documentElement.setAttribute('lang', lang);
      }
      
      // Translate all elements with data-en and data-es attributes
      const elements = document.querySelectorAll('[data-en][data-es]');
      elements.forEach((el) => {
        if (el instanceof HTMLElement) {
          if (lang === 'es' && el.dataset.es) {
            el.textContent = el.dataset.es;
          } else if (el.dataset.en) {
            el.textContent = el.dataset.en;
          }
        }
      });
      
      // Dispatch event for other components
      try {
        window.dispatchEvent(new CustomEvent('languageChanged', { 
          detail: { language: lang } 
        }));
      } catch (e) {
        // Ignore if window not available
      }
    }

    function handleToggle(e) {
      if (e) {
        e.preventDefault();
        e.stopPropagation();
      }
      const currentLang = getCurrentLanguage();
      const newLang = currentLang === 'en' ? 'es' : 'en';
      setLanguage(newLang);
      return false;
    }

    // Initialize
    function init() {
      const toggleButton = document.getElementById('lang-toggle');
      if (toggleButton) {
        // Remove any existing listeners
        const newButton = toggleButton.cloneNode(true);
        toggleButton.parentNode?.replaceChild(newButton, toggleButton);
        
        // Add fresh listeners
        newButton.addEventListener('click', handleToggle);
        newButton.addEventListener('mousedown', function(e) { e.preventDefault(); });
      }
      
      // Apply saved language
      const savedLang = getCurrentLanguage();
      updateLanguageDisplay();
      applyTranslations(savedLang);
    }

    // Run when ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      // DOM already ready
      setTimeout(init, 0);
    }
  })();
</script>

