---
import type { VoteRecord } from '../data/votes.d.ts';

export interface Props {
  records: VoteRecord[];
  showSources?: boolean;
}

const { records, showSources = true } = Astro.props;
const trustees = records[0] ? Object.keys(records[0].votes) : [];
---

{records && records.length > 0 ? (
  <div class="overflow-x-auto">
    <table class="w-full text-sm border-collapse">
      <thead>
        <tr class="border-b-2 border-gray-300">
          <th class="text-left py-3 px-4 font-bold">Date</th>
          <th class="text-left py-3 px-4 font-bold">Item</th>
          <th class="text-left py-3 px-4 font-bold">Motion</th>
          {trustees.map(trustee => (
            <th class="text-left py-3 px-4 font-bold">{trustee}</th>
          ))}
          <th class="text-left py-3 px-4 font-bold">Result</th>
        </tr>
      </thead>
      <tbody>
        {records.map((record) => (
          <tr class="border-b border-gray-200 hover:bg-orange-50 transition-colors">
            <td class="py-3 px-4 text-gray-600">
              {new Date(record.meetingDate).toLocaleDateString()}
            </td>
            <td class="py-3 px-4 font-mono text-xs">{record.itemId}</td>
            <td class="py-3 px-4">
              <div class="font-medium text-gray-900 mb-1">{record.motion}</div>
              {showSources && record.sources && record.sources.length > 0 && (
                <a href={record.sources[0]} target="_blank" rel="noopener noreferrer" class="text-xs text-orange-600 hover:text-orange-700">
                  View Source â†’
                </a>
              )}
            </td>
            {trustees.map(trustee => {
              const vote = record.votes[trustee as keyof typeof record.votes];
              const voteClass = 
                vote === 'Yes' ? 'text-green-700 font-semibold' :
                vote === 'No' ? 'text-red-700 font-semibold' :
                vote === 'Abstain' ? 'text-yellow-700' :
                'text-gray-400';
              return (
                <td class={`py-3 px-4 ${voteClass}`}>
                  {vote}
                </td>
              );
            })}
            <td class="py-3 px-4">
              <span class={`inline-block px-2 py-1 rounded text-xs font-semibold ${
                record.outcome === 'Passed' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
              }`}>
                {record.outcome} {record.voteCount}
              </span>
            </td>
          </tr>
        ))}
      </tbody>
    </table>
  </div>
) : (
  <div class="bg-gray-50 rounded-xl p-8 text-center">
    <p class="text-gray-600">No voting records available yet. Check back after the next board meeting!</p>
  </div>
)}

