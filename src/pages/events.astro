---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import EventItem from '../components/EventItem.astro';
import EventCalendar from '../components/EventCalendar.astro';

const allEvents = await getCollection('events');
const now = new Date();

const upcomingEvents = allEvents
  .filter(event => event.data.date >= now && !event.data.isCanceled)
  .sort((a, b) => a.data.date.valueOf() - b.data.date.valueOf());

const pastEvents = allEvents
  .filter(event => event.data.date < now || event.data.isCanceled)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<BaseLayout
  title="Events"
  description="Join us at upcoming community meetings, school board sessions, and Orange United events."
>
  <div class="bg-gradient-to-br from-orange-50 to-white py-12">
    <div class="container-custom">
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4" data-en="Events" data-es="Eventos">
        Events
      </h1>
      <p class="text-xl text-gray-600 max-w-3xl" data-en="Join us at school board meetings, community gatherings, and opportunities to get involved." data-es="Únete a nosotros en reuniones de la junta escolar, reuniones comunitarias y oportunidades para participar.">
        Join us at school board meetings, community gatherings, and opportunities to get involved.
      </p>
    </div>
  </div>

  <!-- School Board Meetings Info -->
  <section class="py-12 bg-white">
    <div class="container-custom max-w-5xl">
      <div class="bg-gradient-to-br from-gray-50 to-white border-2 border-gray-200 rounded-3xl p-8 md:p-10 shadow-lg mb-8">
        <div class="flex items-center gap-4 mb-6">
          <div class="w-14 h-14 bg-orange-100 rounded-full flex items-center justify-center flex-shrink-0">
            <svg class="w-8 h-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
              </svg>
          </div>
          <h2 class="text-3xl font-bold text-gray-900" data-en="Orange Unified School Board Meetings" data-es="Reuniones de la Junta Escolar Unificada de Orange">Orange Unified School Board Meetings</h2>
        </div>

        <div class="grid md:grid-cols-2 gap-8">
          <!-- Meeting Details -->
          <div>
            <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
              <svg class="w-5 h-5 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              <span data-en="When & Where" data-es="Cuándo y Dónde">When & Where</span>
            </h3>
            <ul class="space-y-3 text-gray-700">
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
                </svg>
                <div>
                  <strong data-en="First Tuesday of each month" data-es="Primer martes de cada mes">First Tuesday of each month</strong><br/>
                  <span data-en="6:00 PM - Usually 2-3 hours" data-es="6:00 PM - Generalmente 2-3 horas">6:00 PM - Usually 2-3 hours</span>
                </div>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                </svg>
                <div>
                  <strong data-en="District Office Board Room" data-es="Sala de la Junta de la Oficina del Distrito">District Office Board Room</strong><br/>
                  1401 N. Handy Street<br/>
                  Orange, CA 92867
                </div>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z" />
                </svg>
                <div>
                  <strong data-en="Watch Online" data-es="Ver en Línea">Watch Online</strong><br/>
                  <a href="https://www.orangeusd.org" target="_blank" class="text-orange-600 underline hover:text-orange-700" data-en="orangeusd.org livestream" data-es="transmisión en vivo de orangeusd.org">orangeusd.org livestream</a>
                </div>
              </li>
            </ul>
          </div>

          <!-- How to Participate -->
          <div>
            <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
              <svg class="w-5 h-5 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
              </svg>
              <span data-en="How to Participate" data-es="Cómo Participar">How to Participate</span>
            </h3>
            <ul class="space-y-3 text-gray-700">
              <li class="flex items-start gap-3">
                <span class="flex-shrink-0 w-6 h-6 bg-orange-500 text-white rounded-full flex items-center justify-center text-sm font-bold">1</span>
                <div>
                  <strong data-en="Arrive Early" data-es="Llega Temprano">Arrive Early</strong><br/>
                  <span data-en="Sign up for public comment at the beginning of the meeting" data-es="Regístrate para comentarios públicos al comienzo de la reunión">Sign up for public comment at the beginning of the meeting</span>
                </div>
              </li>
              <li class="flex items-start gap-3">
                <span class="flex-shrink-0 w-6 h-6 bg-orange-500 text-white rounded-full flex items-center justify-center text-sm font-bold">2</span>
                <div>
                  <strong data-en="Speaking Time" data-es="Tiempo de Hablar">Speaking Time</strong><br/>
                  <span data-en="Each speaker gets 2-3 minutes during public comment period" data-es="Cada orador obtiene 2-3 minutos durante el período de comentarios públicos">Each speaker gets 2-3 minutes during public comment period</span>
                </div>
              </li>
              <li class="flex items-start gap-3">
                <span class="flex-shrink-0 w-6 h-6 bg-orange-500 text-white rounded-full flex items-center justify-center text-sm font-bold">3</span>
                <div>
                  <strong data-en="Stay on Topic" data-es="Mantente en el Tema">Stay on Topic</strong><br/>
                  <span data-en="Address district business, not individual employees" data-es="Aborda asuntos del distrito, no empleados individuales">Address district business, not individual employees</span>
                </div>
              </li>
              <li class="flex items-start gap-3">
                <span class="flex-shrink-0 w-6 h-6 bg-orange-500 text-white rounded-full flex items-center justify-center text-sm font-bold">4</span>
                <div>
                  <strong data-en="Be Respectful" data-es="Sé Respetuoso">Be Respectful</strong><br/>
                  <span data-en="Professional, fact-based comments are most effective" data-es="Los comentarios profesionales y basados en hechos son más efectivos">Professional, fact-based comments are most effective</span>
                </div>
              </li>
            </ul>
          </div>
        </div>

        <div class="mt-8 pt-8 border-t border-gray-200 text-center">
          <p class="text-gray-700 mb-4">
            <strong data-en="First time attending?" data-es="¿Primera vez que asistes?">First time attending?</strong> <span data-en="We can help! Orange United members often attend meetings together." data-es="¡Podemos ayudar! Los miembros de Orange United a menudo asisten a las reuniones juntos.">We can help! Orange United members often attend meetings together.</span>
          </p>
          <div class="flex flex-col sm:flex-row gap-3 justify-center">
            <a href="/board-meeting.ics" class="btn btn-primary inline-flex items-center gap-2" download>
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              <span data-en="Add to Your Calendar" data-es="Agregar a tu Calendario">Add to Your Calendar</span>
            </a>
            <a href="/contact" class="btn btn-outline inline-flex items-center gap-2">
              <span data-en="Get Meeting Support" data-es="Obtener Apoyo para la Reunión">Get Meeting Support</span>
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
              </svg>
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Upcoming Events -->
  <section class="py-12 bg-gray-50">
    <div class="container-custom">
      <h2 class="text-3xl font-bold text-gray-900 mb-8" data-en="Upcoming Events" data-es="Próximos Eventos">Upcoming Events</h2>
      
      {upcomingEvents.length > 0 ? (
        <div class="space-y-6 max-w-4xl">
          {await Promise.all(upcomingEvents.map(async (event) => {
            const { Content } = await event.render();
            return (
              <EventItem
                title={event.data.title}
                date={event.data.date}
                location={event.data.location}
                description={Content}
                rsvpUrl={event.data.rsvpUrl}
                isCanceled={event.data.isCanceled}
              />
            );
          }))}
        </div>
      ) : (
        <div class="max-w-2xl mx-auto">
          <div class="bg-white rounded-3xl p-12 shadow-xl text-center">
            <div class="w-20 h-20 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-6">
              <svg class="w-10 h-10 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
            </div>
            <h3 class="text-2xl font-bold text-gray-900 mb-4" data-en="No Upcoming Community Events" data-es="No Hay Próximos Eventos Comunitarios">No Upcoming Community Events</h3>
            <p class="text-gray-600 mb-8 leading-relaxed" data-en="We're planning community meetings and gatherings. Subscribe to our newsletter to be the first to know when events are scheduled." data-es="Estamos planificando reuniones y encuentros comunitarios. Suscríbete a nuestro boletín para ser el primero en saber cuándo se programan los eventos.">
              We're planning community meetings and gatherings. Subscribe to our newsletter 
              to be the first to know when events are scheduled.
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
              <a href="/#newsletter" class="btn btn-primary inline-flex items-center gap-2">
                <span data-en="Subscribe for Updates" data-es="Suscribirse para Actualizaciones">Subscribe for Updates</span>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                </svg>
              </a>
              <a href="/contact" class="btn btn-outline inline-flex items-center gap-2" data-en="Contact Us" data-es="Contáctanos">
                Contact Us
              </a>
            </div>
          </div>
        </div>
      )}
    </div>
  </section>

  <!-- Calendar at Bottom -->
  <section class="py-12 bg-white">
    <div class="container-custom max-w-5xl">
      <div class="text-center mb-8">
        <h2 class="text-3xl font-bold text-gray-900 mb-4" data-en="Event Calendar" data-es="Calendario de Eventos">Event Calendar</h2>
        <p class="text-gray-600" data-en="View all upcoming events at a glance" data-es="Ver todos los próximos eventos de un vistazo">View all upcoming events at a glance</p>
      </div>
      <EventCalendar events={upcomingEvents} />
    </div>
  </section>
</BaseLayout>

