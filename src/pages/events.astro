---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import EventItem from '../components/EventItem.astro';
import EventCalendar from '../components/EventCalendar.astro';

const allEvents = await getCollection('events');
const now = new Date();

const upcomingEvents = allEvents
  .filter(event => event.data.date >= now && !event.data.isCanceled)
  .sort((a, b) => a.data.date.valueOf() - b.data.date.valueOf());

const pastEvents = allEvents
  .filter(event => event.data.date < now || event.data.isCanceled)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<BaseLayout
  title="Events"
  description="Join us at upcoming community meetings, school board sessions, and Orange United events."
>
  <div class="bg-gradient-to-br from-orange-50 to-white py-12">
    <div class="container-custom">
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
        Events
      </h1>
      <p class="text-xl text-gray-600 max-w-3xl">
        Join us at school board meetings, community gatherings, and opportunities to get involved.
      </p>
    </div>
  </div>

  <!-- School Board Meetings Info -->
  <section class="py-12 bg-white">
    <div class="container-custom max-w-5xl">
      <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-3xl p-8 md:p-10 text-white shadow-2xl mb-8">
        <div class="flex items-center gap-4 mb-6">
          <div class="w-14 h-14 bg-white/20 rounded-full flex items-center justify-center flex-shrink-0">
            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
              </svg>
          </div>
          <h2 class="text-3xl font-bold">Orange Unified School Board Meetings</h2>
        </div>

        <div class="grid md:grid-cols-2 gap-8">
          <!-- Meeting Details -->
          <div>
            <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              When & Where
            </h3>
            <ul class="space-y-3 text-orange-50">
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
                </svg>
                <div>
                  <strong>First Tuesday of each month</strong><br/>
                  6:00 PM - Usually 2-3 hours
                </div>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                </svg>
                <div>
                  <strong>District Office Board Room</strong><br/>
                  1401 N. Handy Street<br/>
                  Orange, CA 92867
                </div>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z" />
                </svg>
                <div>
                  <strong>Watch Online</strong><br/>
                  <a href="https://www.orangeusd.org" target="_blank" class="underline hover:text-white">orangeusd.org livestream</a>
                </div>
              </li>
            </ul>
          </div>

          <!-- How to Participate -->
          <div>
            <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
              </svg>
              How to Participate
            </h3>
            <ul class="space-y-3 text-orange-50">
              <li class="flex items-start gap-3">
                <span class="flex-shrink-0 w-6 h-6 bg-white/20 rounded-full flex items-center justify-center text-sm font-bold">1</span>
                <div>
                  <strong>Arrive Early</strong><br/>
                  Sign up for public comment at the beginning of the meeting
                </div>
              </li>
              <li class="flex items-start gap-3">
                <span class="flex-shrink-0 w-6 h-6 bg-white/20 rounded-full flex items-center justify-center text-sm font-bold">2</span>
                <div>
                  <strong>Speaking Time</strong><br/>
                  Each speaker gets 2-3 minutes during public comment period
                </div>
              </li>
              <li class="flex items-start gap-3">
                <span class="flex-shrink-0 w-6 h-6 bg-white/20 rounded-full flex items-center justify-center text-sm font-bold">3</span>
                <div>
                  <strong>Stay on Topic</strong><br/>
                  Address district business, not individual employees
                </div>
              </li>
              <li class="flex items-start gap-3">
                <span class="flex-shrink-0 w-6 h-6 bg-white/20 rounded-full flex items-center justify-center text-sm font-bold">4</span>
                <div>
                  <strong>Be Respectful</strong><br/>
                  Professional, fact-based comments are most effective
                </div>
              </li>
            </ul>
          </div>
        </div>

        <div class="mt-8 pt-8 border-t border-white/20 text-center">
          <p class="text-orange-100 mb-4">
            First time attending? We can help! Orange United members often attend meetings together.
          </p>
          <a href="/contact" class="btn bg-white text-orange-600 hover:bg-orange-50 inline-flex items-center gap-2">
            Get Meeting Support
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Upcoming Events -->
  <section class="py-12 bg-gray-50">
    <div class="container-custom">
      <h2 class="text-3xl font-bold text-gray-900 mb-8">Upcoming Events</h2>
      
      {upcomingEvents.length > 0 ? (
        <div class="space-y-6 max-w-4xl">
          {await Promise.all(upcomingEvents.map(async (event) => {
            const { Content } = await event.render();
            return (
              <EventItem
                title={event.data.title}
                date={event.data.date}
                location={event.data.location}
                description={Content}
                rsvpUrl={event.data.rsvpUrl}
                isCanceled={event.data.isCanceled}
              />
            );
          }))}
        </div>
      ) : (
        <div class="max-w-2xl mx-auto text-center py-8">
          <p class="text-gray-600">
            Check back for community meetings and gatherings. Board meetings happen monthly (see above).
          </p>
        </div>
      )}
    </div>
  </section>

  <!-- Calendar at Bottom -->
  <section class="py-12 bg-white">
    <div class="container-custom max-w-5xl">
      <div class="text-center mb-8">
        <h2 class="text-3xl font-bold text-gray-900 mb-4">Event Calendar</h2>
        <p class="text-gray-600">View all upcoming events at a glance</p>
      </div>
      <EventCalendar events={upcomingEvents} />
    </div>
  </section>
</BaseLayout>

