---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import EventItem from '../components/EventItem.astro';

const allEvents = await getCollection('events');
const now = new Date();

const upcomingEvents = allEvents
  .filter(event => event.data.date >= now && !event.data.isCanceled)
  .sort((a, b) => a.data.date.valueOf() - b.data.date.valueOf());

const pastEvents = allEvents
  .filter(event => event.data.date < now || event.data.isCanceled)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<BaseLayout
  title="Events"
  description="Join us at upcoming community meetings, school board sessions, and Orange United events."
>
  <div class="bg-gray-50 py-12">
    <div class="container-custom">
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
        Events
      </h1>
      <p class="text-xl text-gray-600 max-w-3xl">
        Join us at school board meetings, community gatherings, and opportunities to get involved.
      </p>
    </div>
  </div>

  <!-- Upcoming Events -->
  <section class="py-12">
    <div class="container-custom">
      <h2 class="text-3xl font-bold text-gray-900 mb-8">Upcoming Events</h2>
      
      {upcomingEvents.length > 0 ? (
        <div class="space-y-6 max-w-4xl">
          {await Promise.all(upcomingEvents.map(async (event) => {
            const { Content } = await event.render();
            return (
              <EventItem
                title={event.data.title}
                date={event.data.date}
                location={event.data.location}
                description={Content}
                rsvpUrl={event.data.rsvpUrl}
                isCanceled={event.data.isCanceled}
              />
            );
          }))}
        </div>
      ) : (
        <div class="max-w-2xl mx-auto">
          <div class="bg-white rounded-3xl p-12 shadow-xl text-center">
            <div class="w-20 h-20 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-6">
              <svg class="w-10 h-10 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
            </div>
            <h3 class="text-2xl font-bold text-gray-900 mb-4">No Upcoming Events</h3>
            <p class="text-gray-600 mb-8 leading-relaxed">
              We're planning community meetings and gatherings. Subscribe to our newsletter 
              to be the first to know when events are scheduled.
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
              <a href="/#newsletter" class="btn btn-primary inline-flex items-center gap-2">
                Subscribe for Updates
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                </svg>
              </a>
              <a href="/contact" class="btn btn-outline inline-flex items-center gap-2">
                Contact Us
              </a>
            </div>
          </div>
        </div>
      )}
    </div>
  </section>

  <!-- Past Events -->
  {pastEvents.length > 0 && (
    <section class="py-12 bg-gray-50">
      <div class="container-custom">
        <h2 class="text-3xl font-bold text-gray-900 mb-8">Past Events</h2>
        
        <div class="space-y-6 max-w-4xl">
          {await Promise.all(pastEvents.slice(0, 6).map(async (event) => {
            const { Content } = await event.render();
            return (
              <EventItem
                title={event.data.title}
                date={event.data.date}
                location={event.data.location}
                description={Content}
                rsvpUrl={event.data.rsvpUrl}
                isCanceled={event.data.isCanceled}
              />
            );
          }))}
        </div>
      </div>
    </section>
  )}
</BaseLayout>

